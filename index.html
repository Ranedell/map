<!DOCTYPE html>
<html>
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Test Telegram WebApps API</title>
   <script src="https://telegram.org/js/telegram-web-app.js"></script> <!--Подключаем скрипт от телеграм-->

   <style>
      body {
         color: var(--tg-theme-text-color);
         background: var(--tg-theme-bg-color);
         display: flex;
         flex-direction: column;
         align-items: center;
         font-size: 18px;
      }

      .hint {
         color: var(--tg-theme-hint-color);
      }

      .link {
         color: var(--tg-theme-link-color);
      }

      .button {
         background: var(--tg-theme-button-color);
         color: var(--tg-theme-button-text-color);
         border: none;
         font-size: 18px;
      }

      .button:not(:last-child) {
         margin-bottom: 20px
      }

      #usercard {
         text-align: center;
      }

      canvas {
         border: 2px solid #000;
      }
   </style>
</head>

<body>
   <div id="usercard"> <!--Карта профиля, человека, который к нам обратился-->
   </div>
   <p>Место для подписи:</p>
   <p class="hint">Оставьте подпись пальцем на экране</p> <!--Просто текст-подсказка для проверки-->
   <canvas id="drawingCanvas" width="300" height="200"></canvas> <!-- Canvas для рисования -->
   <button id="clearButton" class="button">Очистить</button> <!-- Кнопка для очистки -->
   <button id="saveButton" class="button" disabled>Сохранить</button> <!-- Кнопка для сохранения -->
   <button id="sendButton" class="button" disabled>Отправить данные</button> <!-- Кнопка для отправки данных -->

   <script>
      let tg = window.Telegram.WebApp; //получаем объект webapp телеграма 

      tg.expand(); //расширяем на все окно  

      tg.MainButton.text = "Отправить данные"; //изменяем текст кнопки 
      tg.MainButton.setText("Отправить данные"); //изменяем текст кнопки иначе
      tg.MainButton.textColor = "#F55353"; //изменяем цвет текста кнопки
      tg.MainButton.color = "#143F6B"; //изменяем цвет бэкграунда кнопки
      tg.MainButton.setParams({"color": "#143F6B"}); //так изменяются все параметры

      let saveButton = document.getElementById("saveButton"); //получаем кнопку сохранить
      let sendButton = document.getElementById("sendButton"); //получаем кнопку отправить
      let clearButton = document.getElementById("clearButton"); //получаем кнопку очистить

      // Получаем ссылку на Canvas и контекст
      const canvas = document.getElementById("drawingCanvas");
      const ctx = canvas.getContext("2d");

      // Переменная, чтобы определить, начал ли пользователь рисовать
      let isDrawing = false;

      // Начальные координаты и цвет линии
      let lastX = 0;
      let lastY = 0;
      let hue = 0;

      // При нажатии на Canvas начинаем рисовать
      canvas.addEventListener("mousedown", (e) => {
         isDrawing = true;
         [lastX, lastY] = [e.offsetX, e.offsetY];
      });

      // При движении мыши рисуем
      canvas.addEventListener("mousemove", draw);

      // При отпускании кнопки мыши прекращаем рисовать
      canvas.addEventListener("mouseup", () => isDrawing = false);
      canvas.addEventListener("mouseout", () => isDrawing = false);

      function draw(e) {
         if (!isDrawing) return; // Прекращаем функцию, если пользователь не рисует
         ctx.strokeStyle = `hsl(${hue}, 100%, 50%)`; // Устанавливаем цвет линии
         ctx.beginPath();
         ctx.moveTo(lastX, lastY); // Перемещаемся к последним координатам
         ctx.lineTo(e.offsetX, e.offsetY); // Рисуем линию к новым координатам
         ctx.stroke();
         [lastX, lastY] = [e.offsetX, e.offsetY]; // Обновляем координаты
         hue++;
         if (hue >= 360) {
            hue = 0;
         }
      }

      // Кнопка "Очистить"
      clearButton.addEventListener("click", () => {
         ctx.clearRect(0, 0, canvas.width, canvas.height); // Очищаем Canvas
         saveButton.disabled = true; // Делаем кнопку Сохранить неактивной
         sendButton.disabled = true; // Делаем кнопку Отправить данные неактивной
      });

      // Кнопка "Сохранить"
      saveButton.addEventListener("click", () => {
         const dataURL = canvas.toDataURL("image/png"); // Получаем изображение в формате base64
         saveButton.disabled = true; // Делаем кнопку Сохранить неактивной
         sendButton.disabled = false; // Делаем кнопку Отправить данные активной
         tg.sendData(dataURL); // Отправляем данные в бота
      });

      // Кнопка "Отправить данные"
      sendButton.addEventListener("click", () => {
         // Здесь вы можете отправить данные боту, например, через tg.sendData
         // Например, tg.sendData("Данные для бота");
      });
   </script>
</body>
</html>
